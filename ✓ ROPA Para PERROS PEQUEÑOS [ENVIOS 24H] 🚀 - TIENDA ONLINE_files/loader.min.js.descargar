(()=>{var K=Object.defineProperty,Q=Object.defineProperties;var z=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var D=(t,e,n)=>e in t?K(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,a=(t,e)=>{for(var n in e||(e={}))Y.call(e,n)&&D(t,n,e[n]);if(w)for(var n of w(e))G.call(e,n)&&D(t,n,e[n]);return t},m=(t,e)=>Q(t,z(e));var c=(t,e,n)=>new Promise((i,r)=>{var o=l=>{try{s(n.next(l))}catch(_){r(_)}},u=l=>{try{s(n.throw(l))}catch(_){r(_)}},s=l=>l.done?i(l.value):Promise.resolve(l.value).then(o,u);s((n=n.apply(t,e)).next())});var g="__DF_DEBUG_MODE__",x="true",d=window.sessionStorage;function I(){d.setItem(g,x)}function L(){d.removeItem(g)}function b(){return d.getItem(g)===x}function f(t){return d.getItem(t)||window[t]}function p(t,e){d.setItem(t,e)}function y(...t){b()&&console.log("[doofinder]",...t)}var J=10,X=500;function C(t,e={}){let n=document.querySelector(t);return n?Promise.resolve(n):new Promise((i,r)=>{let o=0,u=null,s=e.interval||X,l=e.times||J;u=setInterval(function(){o++<l?(n=document.querySelector(t),n&&(clearInterval(u),i(n))):(clearInterval(u),r(`selector '${t}' not found`))},s)})}var P=3,U="df:trigger:click",W="df:trigger:focus",Z="df:trigger:input",R="df:trigger:submit",E=class{constructor(e){this._minCaptureLength=P,this._elementSelector=e,this.__chooseTriggerElement__(e),this._eventBus=null,this._eventsQueue=[],this._events=[["click",this.handleClick.bind(this),!0],["focus",this.handleFocus.bind(this),!0],["input",this.handleInput.bind(this),!1],["submit",this.handleSubmit.bind(this),!0],["keypress",this.handleKeypress.bind(this),!0],["keyup",this.handleKeypress.bind(this),!0],["keydown",this.handleKeypress.bind(this),!0]],this._handleSubmit=!1,this._enabled=!1,this._redirection=null}__chooseTriggerElement__(e){this._element=Array.from(document.querySelectorAll(e)).find(n=>n.offsetWidth>0&&n.offsetHeight>0)}updateQuery(e=""){return c(this,null,function*(){let n=yield this.getElement();n instanceof HTMLInputElement&&(n.value=e)})}setCaptureLength(e){this._minCaptureLength=e||P}getElement(){return c(this,null,function*(){if(!!this._enabled){if(!this._element)try{this._element=yield C(this._elementSelector)}catch(e){this._element=void 0}return this._element}})}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==!!e){this._enabled=!!e;let n=document[`${this._enabled?"add":"remove"}EventListener`];this._events.forEach(i=>n(...i))}}get captureSubmit(){return this._handleSubmit}set captureSubmit(e){this._handleSubmit=!!e}get redirection(){if(this._redirection)return a({},this._redirection)}set redirection(e){this._redirection=e}setEventBus(e){this._eventBus=e}flushMessages(){var e;if(this._eventsQueue=[...new Map(this._eventsQueue).entries()],this._eventsQueue.length>0){let n=this._eventsQueue.shift();for(;n&&n.length===2;)y("trigger:emit",n),(e=this._eventBus)==null||e.emit(...n),n=this._eventsQueue.shift()}else document.activeElement===this._element&&this.notify(U,this.getPayload())}destroy(){this._events.forEach(e=>window.removeEventListener(...e))}shouldHandle(e){let n=this.getElementFromEvent(e);return n?(this._element=n,!0):!1}getPayload(e){let n={source:this._element,originalEvent:e};if(this._element instanceof HTMLInputElement){let i=this._element.value.trim();i.length>=this._minCaptureLength&&(n.query=i)}return n}getElementFromEvent(e){if(!e.target||e.target===document||e.target===window)return;let n=e.type==="submit"?"querySelector":"closest",i=e.target[n](this._elementSelector);if(i&&!i.closest("[dfd-hook]"))return i}handleClick(e){this.shouldHandle(e)&&(e.preventDefault(),e.stopImmediatePropagation(),this.notify(U,this.getPayload(e)))}handleFocus(e){this.shouldHandle(e)&&(e.stopImmediatePropagation(),this.notify(W,this.getPayload(e)))}handleInput(e){this.shouldHandle(e)&&this.notify(Z,this.getPayload(e))}handleSubmit(e){this._handleSubmit&&this.shouldHandle(e)&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),this.notify(R,this.getPayload(e)))}handleKeypress(e){e.key==="Enter"&&this.shouldHandle(e)&&(!!this._redirection||this._handleSubmit)&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),this._redirection?window.location=this._redirection.url:e.type==="keydown"&&this.notify(R,this.getPayload(e)))}notify(e,n){this._eventBus?this._eventBus.emit(e,n):this._eventsQueue.push([e,n]),y("[trigger]",this._eventBus?"[emit]":"[queue]",e,n)}};function $(t){let e=document.cookie.match(new RegExp("(?:^|; )"+t.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));if(e)return decodeURIComponent(e[1])}function T(t){return`${t}.session`}var S=Object.freeze({language(t){let[e,n]=(t==null?void 0:t.replace("_","-").trim().split("-"))||[];return e&&n?`${e.toLowerCase()}-${n.toUpperCase()}`:e==null?void 0:e.toLowerCase()},currency(t){return t==null?void 0:t.trim().toUpperCase()}});function k(){return f("__DF_CDN_PREFIX__")}function F(t){return f("__DF_LAYER_SERVER__")||`https://${t.toLowerCase()}-layer.doofinder.com`}var N=1;function h(t,e,n){n!=null&&(typeof n!="string"||!!n.trim())&&t.push(`${e}=${n}`)}function ee(t){let{installationId:e,zone:n,language:i,currency:r}=t,u=`${F(n)}/api/${N}/installation/${e}`,s=[];return h(s,"source_url",encodeURIComponent(window.location.href)),h(s,"session_id",$(T(e))),h(s,"language",S.language(i||document.documentElement.getAttribute("lang"))||""),h(s,"currency",S.currency(r)||""),h(s,"vsn","1.4.110"),`${u}?${s.join("&")}`}function te(t){let e=k()||t.cdn_prefix,n=t.vsn,i=r=>`${e}${r}?vsn=${n}`;return b()&&(t.js=t.js.map(r=>r.replace(/\.min\.js/i,".js"))),t.css=t.css.map(i),t.js=t.js.map(i),t}function H(t){return new Promise(function(e,n){fetch(ee(t),{redirect:"follow"}).then(function(i){i.ok?i.json().then(function(r){e(te(r))}):n(`HTTP ${i.status} error response from server`)}).catch(i=>n(i))})}function A(t){return c(this,null,function*(){if(!document.querySelector(`script[src="${t}"]`)){let e=document.createElement("script");e.src=t,e.async=1,document.head.appendChild(e)}})}function V(t){return c(this,null,function*(){if(!document.querySelector(`link[rel="stylesheet"][href="${t}"]`)){let e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("href",t),document.head.appendChild(e)}})}function v(t){return c(this,null,function*(){let e=document.createElement("style");e.appendChild(document.createTextNode((t||"").trim())),document.head.appendChild(e)})}function B(t,e){let n=t.hashid||e.options.hashid,i=e.options,{autoload:r}=e,o="urlHash"in t?!!t.urlHash:!!i.url_hash;return delete t.urlHash,delete i.url_hash,m(a(a({},t),i),{autoload:r,urlHash:o,hashid:n})}function M(){return window.doofinder!=null?Promise.resolve(window.doofinder):new Promise(t=>{document.addEventListener("doofinder.hello",e=>t(e.detail),{once:!0})})}function O(t){return p("__DF_CDN_PREFIX__",t)}function j(t){return p("__DF_LAYER_SERVER__",t)}function q(){try{decodeURIComponent(location.href)}catch(t){throw new Error("invalid UTF-8 on url-encoded query params")}}var ne=M(),ie={vsn:"1.4.110",load(t,e){q(),H(t).then(n=>{var o;n.css.forEach(V),n.custom_css.forEach(v),n.js.forEach(A);let i=B(t,n),r=(o=n.custom_properties)==null?void 0:o.join(`
`);oe(i,r,e)}).catch(n=>{console.error("[Doofinder] error retrieving resources:",n)})},enableDebug:I,disableDebug:L,setLayerServerUrl:j,setCDNServerUrl:O};function re(t){let{autoload:e,trigger:n}=t,i=new E(n);return i.enabled=!e||e.trigger,i}function oe(t,e,n){let i=re(t);ne.then(r=>{let o=r.create(m(a({},t),{trigger:i}));v(`#${o.mount.id} {
${e||""}
}`),typeof n=="function"&&n(o),r.debug("layer created:",o)})}window.doofinderLoader=ie;})();
